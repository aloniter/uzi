<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××¢×§×‘ ×¢×•×–×™ - Live ğŸ•</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header .subtitle { opacity: 0.95; font-size: 14px; line-height: 1.5; margin-top: 5px; }
        #puppyAge { display: inline-block; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; margin-bottom: 5px; }

        .connection-status {
            position: absolute; top: 10px; right: 10px; width: 12px; height: 12px;
            border-radius: 50%; background: #4CAF50; animation: pulse 2s infinite;
        }
        .connection-status.offline { background: #ff4444; animation: none; }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        .user-indicator {
            position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2);
            padding: 5px 12px; border-radius: 20px; font-size: 12px;
        }

        .tabs { display: flex; background: #f5f5f5; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s; font-weight: 500; color: #333; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }

        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }

        .action-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 25px; }
        .action-btn {
            padding: 20px; border-radius: 15px; border: none; cursor: pointer; font-size: 16px;
            font-weight: 600; transition: all 0.3s; display: flex; flex-direction: column;
            align-items: center; gap: 8px; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .action-btn:active { transform: scale(0.95); }
        .action-btn .emoji { font-size: 30px; }

        .action-btn.food { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .action-btn.sleep { background: linear-gradient(135deg, #5ee7df 0%, #b490ca 100%); }
        .action-btn.play { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .action-btn.training { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .action-btn.pee { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .action-btn.poop { background: linear-gradient(135deg, #cd9cf2 0%, #f6f3ff 100%); color: #333; }
        .action-btn.walk { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .action-btn.vet { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }

        .history-item {
            background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; animation: slideIn 0.3s;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .history-item .time { font-weight: 600; color: #667eea; }
        .history-item .activity { display: flex; align-items: center; gap: 8px; }
        .history-item .user { font-size: 12px; color: #666; background: #e0e0e0; padding: 2px 8px; border-radius: 10px; }
        .delete-btn, .edit-btn {
            color: white; border: none; padding: 4px 10px; border-radius: 5px;
            cursor: pointer; font-size: 12px; margin-left: 5px;
        }
        .delete-btn { background: #ff4444; }
        .edit-btn { background: #2196F3; }

        .user-switch { display: flex; gap: 10px; margin-bottom: 20px; background: #f0f0f0; padding: 5px; border-radius: 10px; }
        .user-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; background: transparent; }
        .user-btn.active { background: white; color: #667eea; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .note-input { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; margin-bottom: 10px; resize: none; }
        .note-input:focus { outline: none; border-color: #667eea; }

        .live-indicator { background: #4CAF50; color: white; padding: 4px 8px; border-radius: 5px; font-size: 10px; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .day-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 15px; border-radius: 10px; margin-bottom: 10px; font-weight: 600; }
        .date-filter { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
        .date-filter input { flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .date-filter button { padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; }

        /* Edit Modal Styles */
        .modal-overlay {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; margin: 15% auto; padding: 20px;
            border-radius: 15px; border: 1px solid #888; width: 90%; max-width: 400px;
        }
        .modal-content h3 { margin-bottom: 15px; }
        .modal-content label { display: block; margin-top: 10px; margin-bottom: 5px; font-weight: 600; }
        .modal-content input, .modal-content textarea { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }
        .modal-buttons { margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end; }
        .modal-buttons button { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; }
        #modalSaveBtn { background-color: #4CAF50; color: white; }
        #modalCancelBtn { background-color: #f44336; color: white; }

        /* Schedule Styles */
        .schedule-item { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-right: 4px solid #667eea; position: relative; }
        .schedule-item.edit-mode { background: #f0f4ff; border: 2px solid #2196F3; }
        .schedule-item .time { font-size: 18px; font-weight: 600; color: #667eea; margin-bottom: 5px; }
        .schedule-item .activity-desc { color: #333; }
        .schedule-item .delete-schedule-btn { position: absolute; top: 10px; left: 10px; background: #ff4444; color: white; border: none; padding: 4px 8px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .schedule-item input[type="time"], .schedule-item input[type="text"] { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="app-container" id="appContainer">
        <div class="header">
            <div class="connection-status" id="connectionStatus" title="××—×•×‘×¨"></div>
            <div class="user-indicator" id="currentUserDisplay">××©×ª××©: </div>
            <h1>ğŸ• ×¢×•×–×™</h1>
            <div class="subtitle">
                <span id="puppyAge" style="font-weight: bold; font-size: 16px;"></span><br>
                <span style="font-size: 12px;">× ×•×œ×“: 22.6.2025</span>
                <span class="live-indicator" style="margin-right: 10px;">LIVE</span>
            </div>
        </div>
        <div class="tabs">
            <div class="tab active" data-tab="record">×¨×™×©×•×</div>
            <div class="tab" data-tab="history">×”×™×¡×˜×•×¨×™×”</div>
            <div class="tab" data-tab="schedule">×œ×•"×–</div>
            <div class="tab" data-tab="stats">×¡×˜×˜×™×¡×˜×™×§×”</div>
        </div>
        <div id="record" class="tab-content active">
             <div class="user-switch">
                <button class="user-btn active" data-user="××œ×•×Ÿ">××œ×•×Ÿ</button>
                <button class="user-btn" data-user="× ×¢××™">× ×¢××™</button>
            </div>
            <div class="action-buttons">
                <button class="action-btn food" data-type="××•×›×œ" data-emoji="ğŸ–"><span class="emoji">ğŸ–</span><span>××•×›×œ</span></button>
                <button class="action-btn sleep" data-type="×©×™× ×”" data-emoji="ğŸ˜´"><span class="emoji">ğŸ˜´</span><span>×©×™× ×”</span></button>
                <button class="action-btn play" data-type="××©×—×§" data-emoji="ğŸ¾"><span class="emoji">ğŸ¾</span><span>××©×—×§</span></button>
                <button class="action-btn training" data-type="××™××•×Ÿ" data-emoji="ğŸ¯"><span class="emoji">ğŸ¯</span><span>××™××•×Ÿ</span></button>
                <button class="action-btn pee" data-type="×¤×™×¤×™" data-emoji="ğŸ’§"><span class="emoji">ğŸ’§</span><span>×¤×™×¤×™</span></button>
                <button class="action-btn poop" data-type="×§×§×™" data-emoji="ğŸ’©"><span class="emoji">ğŸ’©</span><span>×§×§×™</span></button>
                <button class="action-btn walk" data-type="×˜×™×•×œ" data-emoji="ğŸš¶"><span class="emoji">ğŸš¶</span><span>×˜×™×•×œ</span></button>
                <button class="action-btn vet" data-type="×•×˜×¨×™× ×¨" data-emoji="ğŸ¥"><span class="emoji">ğŸ¥</span><span>×•×˜×¨×™× ×¨</span></button>
            </div>
            <textarea class="note-input" id="noteInput" placeholder="×”×•×¡×£ ×”×¢×¨×” (××•×¤×¦×™×•× ×œ×™)..." rows="3"></textarea>
        </div>
        <div id="history" class="tab-content">
             <div class="date-filter">
                <input type="date" id="dateFilter">
                <button id="showTodayBtn">×”×™×•×</button>
                <button id="showAllBtn">×”×›×œ</button>
            </div>
            <div id="historyList"></div>
        </div>
        <div id="schedule" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div style="font-size: 18px; font-weight: 600; color: #333;">×œ×•×— ×–×× ×™× ×™×•××™</div>
                <button id="editScheduleBtn" style="background: #2196F3; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer;">âœï¸ ×¢×¨×•×š ×œ×•"×–</button>
            </div>
            <div id="scheduleItems"></div>
            <div id="scheduleEditSection" style="display: none;">
                <button id="addScheduleItemBtn" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 15px;">â• ×”×•×¡×£ ×¤×¢×™×œ×•×ª ×—×“×©×”</button>
                <button id="saveScheduleBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px;">ğŸ’¾ ×©××•×¨ ×œ×•"×–</button>
                <button id="resetScheduleBtn" style="background: #ff4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px;">ğŸ”„ ××¤×¡ ×œ×‘×¨×™×¨×ª ××—×“×œ</button>
            </div>
        </div>
        <div id="stats" class="tab-content">
             <p style="text-align:center; color:#999;">×¡×˜×˜×™×¡×˜×™×§×•×ª ×™×ª×•×•×¡×¤×• ×‘×§×¨×•×‘.</p>
        </div>
    </div>

    <div id="editModal" class="modal-overlay">
        <div class="modal-content">
            <h3>×¢×¨×™×›×ª ×¤×¢×™×œ×•×ª</h3>
            <input type="hidden" id="editActivityId">
            <label for="editTime">×©×¢×”:</label>
            <input type="time" id="editTime">
            <label for="editNote">×”×¢×¨×”:</label>
            <textarea id="editNote" rows="3"></textarea>
            <div class="modal-buttons">
                <button id="modalCancelBtn">×‘×™×˜×•×œ</button>
                <button id="modalSaveBtn">×©××™×¨×”</button>
            </div>
        </div>
    </div>

    <script>
        // --- Global Variables ---
        let currentUser = '××œ×•×Ÿ';
        let activities = [];
        let database = null;
        let filterDate = null;
        let schedule = [];
        let isEditingSchedule = false;

        const defaultSchedule = [
            { time: "06:00", activity: "ğŸŒ… ×”×©×›××” + ×¤×™×¤×™ ×¨××©×•×Ÿ" }, { time: "06:30", activity: "ğŸ– ××¨×•×—×ª ×‘×•×§×¨" },
            { time: "08:00", activity: "ğŸš¶ ×˜×™×•×œ ×§×¦×¨ + ×¦×¨×›×™×" }, { time: "09:00", activity: "ğŸ¾ ×–××Ÿ ××©×—×§ ×•×¤×¢×™×œ×•×ª" },
            { time: "10:00", activity: "ğŸ˜´ ×ª× ×•××”" }, { time: "12:00", activity: "ğŸ– ××¨×•×—×ª ×¦×”×¨×™×™×" },
            { time: "13:00", activity: "ğŸš¶ ×˜×™×•×œ + ×¦×¨×›×™×" }, { time: "14:00", activity: "ğŸ¯ ×–××Ÿ ××™××•×Ÿ (5-10 ×“×§×•×ª)" },
            { time: "15:00", activity: "ğŸ˜´ ×× ×•×—×ª ××—×”\"×¦" }, { time: "17:00", activity: "ğŸ¾ ××©×—×§ ×•×¤×¢×™×œ×•×ª" },
            { time: "18:00", activity: "ğŸ– ××¨×•×—×ª ×¢×¨×‘" }, { time: "19:00", activity: "ğŸš¶ ×˜×™×•×œ ×¢×¨×‘ + ×¦×¨×›×™×" },
            { time: "20:00", activity: "ğŸ¯ ××™××•×Ÿ ×§×¦×¨" }, { time: "21:00", activity: "ğŸ˜´ ×”×›× ×” ×œ×©×™× ×ª ×œ×™×œ×”" },
            { time: "23:00", activity: "ğŸ’§ ×¤×™×¤×™ ××—×¨×•×Ÿ ×œ×¤× ×™ ×”×©×™× ×”" }
        ];

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDj_SEXQ6irE7RL0_9RNkktzWSzPh8eVys",
            authDomain: "puppy-tracker-82cb0.firebaseapp.com",
            databaseURL: "https://puppy-tracker-82cb0-default-rtdb.europe-west1.firebasedabase.app",
            projectId: "puppy-tracker-82cb0",
            storageBucket: "puppy-tracker-82cb0.firebasestorage.app",
            messagingSenderId: "565635528841",
            appId: "1:565635528841:web:e2bd7f4f10910d1ae1ae58"
        };

        // --- Main Application Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                setupFirebaseListeners();
            } catch (error) {
                console.error('Firebase initialization error:', error);
            }
            setupEventListeners();
            loadInitialData();
        });

        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => switchToTab(tab.dataset.tab)));
            document.querySelectorAll('.user-btn').forEach(btn => btn.addEventListener('click', () => switchUser(btn.dataset.user)));
            document.querySelectorAll('.action-btn').forEach(btn => btn.addEventListener('click', () => recordActivity(btn.dataset.type, btn.dataset.emoji)));
            document.getElementById('dateFilter').addEventListener('change', filterByDate);
            document.getElementById('showTodayBtn').addEventListener('click', showToday);
            document.getElementById('showAllBtn').addEventListener('click', showAll);
            // Modal listeners
            document.getElementById('modalCancelBtn').addEventListener('click', closeEditModal);
            document.getElementById('modalSaveBtn').addEventListener('click', saveActivityChanges);
            // Schedule listeners
            document.getElementById('editScheduleBtn').addEventListener('click', toggleScheduleEdit);
            document.getElementById('addScheduleItemBtn').addEventListener('click', addScheduleItem);
            document.getElementById('saveScheduleBtn').addEventListener('click', saveSchedule);
            document.getElementById('resetScheduleBtn').addEventListener('click', resetSchedule);
        }

        function loadInitialData() {
            if (database) {
                listenToActivities();
                loadSchedule();
            }
            calculatePuppyAge();
            setInterval(calculatePuppyAge, 60000);
            const savedUser = localStorage.getItem('currentUser');
            switchUser(savedUser || '××œ×•×Ÿ');
        }

        // --- Firebase Functions ---
        function setupFirebaseListeners() {
            firebase.database().ref('.info/connected').on('value', (snapshot) => {
                const status = document.getElementById('connectionStatus');
                status.classList.toggle('offline', !snapshot.val());
                status.title = snapshot.val() ? '××—×•×‘×¨' : '×œ× ××—×•×‘×¨';
            });
        }
        
        function listenToActivities() {
            database.ref('activities').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                activities = Object.keys(data).map(key => ({ ...data[key], id: key })).sort((a, b) => b.timestamp - a.timestamp);
                
                const activeTab = document.querySelector('.tab.active').dataset.tab;
                if (activeTab === 'history') displayHistory();
            });
        }

        // --- UI & State Management ---
        function switchToTab(tabName) {
            document.querySelectorAll('.tab-content, .tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            if (tabName === 'history') displayHistory();
            if (tabName === 'schedule') loadSchedule();
        }

        function switchUser(user) {
            currentUser = user;
            document.getElementById('currentUserDisplay').textContent = '××©×ª××©: ' + user;
            localStorage.setItem('currentUser', user);
            document.querySelectorAll('.user-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.user === user));
        }

        async function recordActivity(type, emoji) {
            if (!database) return alert('×œ× ××—×•×‘×¨ ×œ-Firebase');
            const activity = {
                type, emoji, user: currentUser,
                note: document.getElementById('noteInput').value,
                time: new Date().toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' }),
                date: new Date().toLocaleDateString('he-IL'),
                timestamp: Date.now()
            };
            try {
                await database.ref('activities').push(activity);
                document.getElementById('noteInput').value = '';
                showNotification(`${emoji} ${type} × ×¨×©× ×‘×”×¦×œ×—×”!`);
                switchToTab('history'); // Switch to history tab after recording
            } catch (error) { alert('×©×’×™××” ×‘×¨×™×©×•×: ' + error.message); }
        }
        
        // --- History & Editing Functions ---
        function displayHistory() {
            let filtered = filterDate ? activities.filter(act => act.date === filterDate) : activities;
            const grouped = filtered.reduce((acc, act) => {
                (acc[act.date] = acc[act.date] || []).push(act);
                return acc;
            }, {});
            
            const sortedDates = Object.keys(grouped).sort((a, b) => {
                const dateA = a.split('.').reverse().join('-');
                const dateB = b.split('.').reverse().join('-');
                return dateB.localeCompare(dateA);
            });

            document.getElementById('historyList').innerHTML = sortedDates.map(date => `
                <div class="day-section">
                    <div class="day-header">${date === new Date().toLocaleDateString('he-IL') ? '×”×™×•× - ' : ''}${date}</div>
                    ${grouped[date].map(act => `
                        <div class="history-item">
                            <div class="activity" style="flex-grow: 1; text-align: right;">
                                <span>${act.emoji} ${act.type}</span>
                                ${act.note ? `<span style="color: #666; font-size: 12px; display: block;">(${act.note})</span>` : ''}
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px; flex-shrink: 0;">
                                <span class="time">${act.time}</span>
                                <span class="user">${act.user}</span>
                                <button class="edit-btn" onclick="openEditModal('${act.id}')">×¢×¨×•×š</button>
                                <button class="delete-btn" onclick="deleteActivity('${act.id}')">××—×§</button>
                            </div>
                        </div>`).join('')}
                </div>`).join('') || '<div style="text-align: center; color: #999; padding: 20px;">××™×Ÿ ×¤×¢×™×œ×•×™×•×ª</div>';
        }

        async function deleteActivity(id) {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×”×¤×¢×™×œ×•×ª?')) {
                try {
                    await database.ref(`activities/${id}`).remove();
                    showNotification('×”×¤×¢×™×œ×•×ª × ××—×§×”');
                } catch (error) { alert('×©×’×™××” ×‘××—×™×§×”: ' + error.message); }
            }
        }
        
        function openEditModal(id) {
            const activity = activities.find(act => act.id === id);
            if (!activity) return;

            document.getElementById('editActivityId').value = id;
            document.getElementById('editTime').value = activity.time;
            document.getElementById('editNote').value = activity.note || '';
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        async function saveActivityChanges() {
            const id = document.getElementById('editActivityId').value;
            const newTime = document.getElementById('editTime').value;
            const newNote = document.getElementById('editNote').value;
            
            if (!id || !newTime) return alert("×”×©×¢×” ×”×™× ×©×“×” ×—×•×‘×”.");
            
            try {
                await database.ref(`activities/${id}`).update({ time: newTime, note: newNote });
                showNotification('×”×¤×¢×™×œ×•×ª ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!');
                closeEditModal();
            } catch (error) {
                alert('×©×’×™××” ×‘×¢×“×›×•×Ÿ: ' + error.message);
            }
        }
        
        // --- Schedule Functions ---
        function loadSchedule() {
            if (database) {
                database.ref('schedule').once('value', (snapshot) => {
                    const data = snapshot.val();
                    schedule = data ? data : [...defaultSchedule];
                    displaySchedule();
                });
            } else {
                schedule = [...defaultSchedule];
                displaySchedule();
            }
        }

        function displaySchedule() {
            const container = document.getElementById('scheduleItems');
            schedule.sort((a, b) => a.time.localeCompare(b.time));

            container.innerHTML = schedule.map((item, index) => {
                if (isEditingSchedule) {
                    return `
                    <div class="schedule-item edit-mode">
                        <input type="time" value="${item.time}" onchange="updateScheduleTime(${index}, this.value)">
                        <input type="text" value="${item.activity}" onchange="updateScheduleActivity(${index}, this.value)" placeholder="×ª×™××•×¨ ×”×¤×¢×™×œ×•×ª...">
                        <button class="delete-schedule-btn" onclick="removeScheduleItem(${index})">ğŸ—‘ï¸</button>
                    </div>`;
                }
                return `
                    <div class="schedule-item">
                        <div class="time">${item.time}</div>
                        <div class="activity-desc">${item.activity}</div>
                    </div>`;
            }).join('');
        }
        
        function toggleScheduleEdit() {
            isEditingSchedule = !isEditingSchedule;
            const btn = document.getElementById('editScheduleBtn');
            const editSection = document.getElementById('scheduleEditSection');
            
            if (isEditingSchedule) {
                btn.textContent = 'âŒ ×‘×™×˜×•×œ ×¢×¨×™×›×”';
                btn.style.background = '#ff4444';
                editSection.style.display = 'block';
            } else {
                btn.textContent = 'âœï¸ ×¢×¨×•×š ×œ×•"×–';
                btn.style.background = '#2196F3';
                editSection.style.display = 'none';
            }
            displaySchedule();
        }

        function updateScheduleTime(index, time) { schedule[index].time = time; }
        function updateScheduleActivity(index, activity) { schedule[index].activity = activity; }
        
        function removeScheduleItem(index) {
            if (confirm('×œ××—×•×§ ××ª ×”×¤×¢×™×œ×•×ª ×”×–×• ××”×œ×•"×–?')) {
                schedule.splice(index, 1);
                displaySchedule();
            }
        }

        function addScheduleItem() {
            schedule.push({ time: "12:00", activity: "ğŸ†• ×¤×¢×™×œ×•×ª ×—×“×©×”" });
            displaySchedule();
        }

        async function saveSchedule() {
            try {
                if (database) await database.ref('schedule').set(schedule);
                showNotification('×”×œ×•"×– × ×©××¨ ×‘×”×¦×œ×—×”!');
                toggleScheduleEdit();
            } catch (error) { alert('×©×’×™××” ×‘×©××™×¨×”: ' + error.message); }
        }

        function resetSchedule() {
            if (confirm('×œ××¤×¡ ××ª ×”×œ×•"×– ×œ×‘×¨×™×¨×ª ×”××—×“×œ?')) {
                schedule = [...defaultSchedule];
                displaySchedule();
                saveSchedule();
                showNotification('×”×œ×•"×– ××•×¤×¡ ×œ×‘×¨×™×¨×ª ×”××—×“×œ');
            }
        }

        // --- History Filters ---
        function filterByDate() {
            filterDate = document.getElementById('dateFilter').value ? new Date(document.getElementById('dateFilter').value).toLocaleDateString('he-IL') : null;
            displayHistory();
        }
        function showToday() {
            filterDate = new Date().toLocaleDateString('he-IL');
            document.getElementById('dateFilter').value = new Date().toISOString().split('T')[0];
            displayHistory();
        }
        function showAll() {
            filterDate = null;
            document.getElementById('dateFilter').value = '';
            displayHistory();
        }
        
        // --- Utility Functions ---
        function calculatePuppyAge() {
            const birthDate = new Date(2025, 5, 22); // Month is 0-indexed (5 = June)
            const today = new Date();
            // If birth date is in the future, calculate based on today's date for age calculation to avoid negative numbers in display logic.
            const calculationDate = today < birthDate ? birthDate : today;
            const diffDays = Math.floor((today - birthDate) / (1000 * 60 * 60 * 24));
            
            let ageText;
            if (diffDays < 0) {
                ageText = `×¢×•×“ ${Math.abs(diffDays)} ×™××™× ×œ×”×•×œ×“×ª ×¢×•×–×™!`;
                document.getElementById('puppyAge').textContent = ageText;
                return;
            }
            
            if (diffDays <= 1) {
                ageText = "× ×•×œ×“ ×”×™×•×!";
            } else if (diffDays < 60) {
                const weeks = Math.floor(diffDays / 7);
                const days = diffDays % 7;
                ageText = `×‘×Ÿ ${weeks} ×©×‘×•×¢×•×ª ×•-${days} ×™××™×`;
            } else {
                const months = Math.floor(diffDays / 30.44);
                const days = Math.floor(diffDays % 30.44);
                ageText = `×‘×Ÿ ${months} ×—×•×“×©×™× ×•-${days} ×™××™×`;
            }
            document.getElementById('puppyAge').textContent = `${ageText} (${diffDays} ×™××™×)`;
        }

        function showNotification(message) {
            const el = document.createElement('div');
            el.style.cssText = `position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4CAF50; color: white; padding: 12px 24px; border-radius: 10px; z-index: 1001;`;
            el.textContent = message;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 3000);
        }
    </script>
</body>
</html>
